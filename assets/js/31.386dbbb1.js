(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{202:function(t,s,a){"use strict";a.r(s);var e=a(0),n=Object(e.a)({},(function(){var t=this.$createElement;this._self._c;return this._m(0)}),[function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("div",{staticClass:"content"},[a("p"),a("div",{staticClass:"table-of-contents"},[a("ul",[a("li",[a("a",{attrs:{href:"#storage"}},[t._v("Storage")]),a("ul",[a("li",[a("a",{attrs:{href:"#storage-directory-structure"}},[t._v("Storage Directory Structure")])]),a("li",[a("a",{attrs:{href:"#high-level-paths"}},[t._v("High Level Paths")])]),a("li",[a("a",{attrs:{href:"#consolables"}},[t._v("Consolables")]),a("ul",[a("li",[a("a",{attrs:{href:"#storage-link"}},[t._v("Storage Link")])])])])])])])]),a("p"),t._v(" "),a("h1",{attrs:{id:"storage"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storage"}},[t._v("#")]),t._v(" Storage")]),t._v(" "),a("p",[t._v("Miru comes with a concept called Storage.\n")]),t._v(" "),a("h2",{attrs:{id:"storage-directory-structure"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storage-directory-structure"}},[t._v("#")]),t._v(" Storage Directory Structure")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Relative Path")]),t._v(" "),a("th",[t._v("Description")]),t._v(" "),a("th",[t._v("git")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("/storage")])]),t._v(" "),a("td",[t._v("Storage root")]),t._v(" "),a("td",[t._v("commit")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/storage/assets")])]),t._v(" "),a("td",[t._v("Files required for the Application to run properly")]),t._v(" "),a("td",[t._v("commit")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/storage/assets/public")])]),t._v(" "),a("td",[t._v("Files that will be exposed on the webserver (wwwroot/public)")]),t._v(" "),a("td",[t._v("commit")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/storage/app")])]),t._v(" "),a("td",[t._v("Directory where the Application can save user's files")]),t._v(" "),a("td",[t._v("ignore")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/storage/db")])]),t._v(" "),a("td",[t._v("Directory where some database can be stored")]),t._v(" "),a("td",[t._v("ignore")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/storage/temp")])]),t._v(" "),a("td",[t._v("Temporary files that can be deleted from time to time")]),t._v(" "),a("td",[t._v("ignore")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/storage/logs")])]),t._v(" "),a("td",[t._v("Where the Application save logs")]),t._v(" "),a("td",[t._v("ignore")])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("/storage/tests")])]),t._v(" "),a("td",[t._v("Replicates the same structure of /storage but for Testing. It is erased before a test is run")]),t._v(" "),a("td",[t._v("ignore")])])])]),t._v(" "),a("h2",{attrs:{id:"high-level-paths"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#high-level-paths"}},[t._v("#")]),t._v(" High Level Paths")]),t._v(" "),a("p",[t._v("Miru's Storage's design provides a way to use "),a("strong",[t._v("High Level Paths")]),t._v("\nin your application. Instead of using "),a("code",[t._v('_storage.App / "invoices" / $"invoice-{invoice.Id}.pdf"')]),t._v("\nyou can use "),a("code",[t._v("_storage.App.InvoicePdf(invoice)")]),t._v(".")]),t._v(" "),a("p",[t._v("Create a class "),a("code",[t._v("MiruPathExtensions")]),t._v(" and add methods for you Application's files/directories:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiruPathExtensions")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("MiruPath")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("InvoicePdf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MiruPath")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Invoice")]),t._v(" invoice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("\n        path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"invoices"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token interpolation-string"}},[a("span",{pre:!0,attrs:{class:"token string"}},[t._v('$"invoice-')]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token expression language-csharp"}},[t._v("invoice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Id")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('.pdf"')])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("In your "),a("code",[t._v("Features' Handlers")]),t._v(" or other services, you use your\n"),a("strong",[t._v("High Level Paths")]),t._v(" through "),a("code",[t._v("IStorage")]),t._v("'s App property:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token type-list"}},[a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IRequestHandler"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Query"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Result"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppDbContext")]),t._v(" _db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IStorage")]),t._v(" _storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Handler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("AppDbContext")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IStorage")]),t._v(" storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        _db "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        _storage "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Handle")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Query")]),t._v(" request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CancellationToken")]),t._v(" ct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" invoice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" _db"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Invoices"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("ByIdAsync")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("OrderId"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ct"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" invoicePath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("App"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("InvoicePdf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("invoice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Result")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            InvoicePath "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" invoicePath\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("Since the "),a("strong",[t._v("High Level Paths")]),t._v(" are extensions of "),a("code",[t._v("MiruPath")]),t._v(" class,\nyou can use your custom paths in other storage's directories:")]),t._v(" "),a("div",{staticClass:"language-csharp extra-class"},[a("pre",{pre:!0,attrs:{class:"language-csharp"}},[a("code",[a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" tempInvoice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" _storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("Temp")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("InvoicePdf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("invoice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" customDirInvoice "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("_storage"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("StorageDir "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"custom"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("InvoicePdf")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("invoice"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),a("h2",{attrs:{id:"consolables"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#consolables"}},[t._v("#")]),t._v(" Consolables")]),t._v(" "),a("h3",{attrs:{id:"storage-link"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#storage-link"}},[t._v("#")]),t._v(" Storage Link")]),t._v(" "),a("p",[t._v("Since all Application's assets are saved into "),a("code",[t._v("/storage/assets")]),t._v(" and the\nWeb Application's static assets are mapped in "),a("code",[t._v("/src/{App}/wwwroot")]),t._v(", we can\ncreate a symlink between "),a("code",[t._v("/storage/assets/public")]),t._v(" and "),a("code",[t._v("/src/{App}/wwwroot/public")]),t._v(" using "),a("code",[t._v("storage.link")]),t._v(" command:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("miru storage.link\n")])])])])}],!1,null,null,null);s.default=n.exports}}]);