(window.webpackJsonp=window.webpackJsonp||[]).push([[30],{201:function(t,s,e){"use strict";e.r(s);var a=e(0),r=Object(a.a)({},(function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"content"},[e("p"),t._m(0),e("p"),t._v(" "),t._m(1),t._v(" "),e("p",[t._v("Miru has some Queueing facilities on top of "),e("a",{attrs:{href:"https://www.hangfire.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hangfire"),e("OutboundLink")],1),t._v(".")]),t._v(" "),t._m(2),t._v(" "),e("p",[t._v("To create a Job, a Maker from MiruCli can be used:")]),t._v(" "),t._m(3),t._m(4),t._v(" "),t._m(5),t._v(" "),e("p",[t._v("A Job is composed by the Request and the Handler. It is a class named after the job being done (e.g. OrderPlaced, UserCreated, and ImageAttached). Request and Handler stay inside as subclasses:")]),t._v(" "),t._m(6),e("p",[t._v("The class's file can be placed in the Feature's folder. Examples:")]),t._v(" "),t._m(7),t._m(8),t._v(" "),t._m(9),t._v(" "),t._m(10),t._m(11),t._v(" "),t._m(12),t._v(" "),t._m(13),t._m(14),t._v(" "),t._m(15),t._v(" "),t._m(16),t._m(17),t._m(18),t._v(" "),e("p",[t._v("The queued jobs are processed by Hangfire's "),e("a",{attrs:{href:"https://docs.hangfire.io/en/latest/background-processing/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("BackgroundJobServer"),e("OutboundLink")],1),t._v(". There are two ways of start the server and keep it running: together with the WebApp or standalone.")]),t._v(" "),t._m(19),t._v(" "),t._m(20),t._v(" "),t._m(21),t._m(22),t._v(" "),e("p",[t._v("Can be started invoking:")]),t._v(" "),t._m(23),t._m(24),t._v(" "),t._m(25),t._v(" "),t._m(26),t._v(" "),t._m(27),t._m(28),t._v(" "),e("p",[t._v("Configurations can be customized using "),e("a",{attrs:{href:"https://docs.hangfire.io/en/latest/configuration/using-dashboard.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("Hangfire's API"),e("OutboundLink")],1),t._v(".")])])}),[function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"table-of-contents"},[e("ul",[e("li",[e("a",{attrs:{href:"#queueing"}},[t._v("Queueing")]),e("ul",[e("li",[e("a",{attrs:{href:"#create-a-job"}},[t._v("Create a Job")])]),e("li",[e("a",{attrs:{href:"#job"}},[t._v("Job")]),e("ul",[e("li",[e("a",{attrs:{href:"#request"}},[t._v("Request")])]),e("li",[e("a",{attrs:{href:"#handler"}},[t._v("Handler")])])])]),e("li",[e("a",{attrs:{href:"#queueing-jobs"}},[t._v("Queueing Jobs")])]),e("li",[e("a",{attrs:{href:"#processing-queued-jobs"}},[t._v("Processing Queued Jobs")]),e("ul",[e("li",[e("a",{attrs:{href:"#server-with-webapp"}},[t._v("Server with WebApp")])]),e("li",[e("a",{attrs:{href:"#server-standalone"}},[t._v("Server Standalone")])])])]),e("li",[e("a",{attrs:{href:"#dashboard"}},[t._v("Dashboard")])])])])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"queueing"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#queueing"}},[this._v("#")]),this._v(" Queueing")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"create-a-job"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#create-a-job"}},[this._v("#")]),this._v(" Create a Job")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("miru make:job Accounts Account Created\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"/Queueing-Make.png",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"job"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#job"}},[this._v("#")]),this._v(" Job")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Not")]),t._v(" Found"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" D"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\Projects\\Miru"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("samples"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Skeleton"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Skeleton"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Features"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Orders"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("OrderPaid"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cs")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[this._v("/src/App/Features/Orders/OrderPaid.cs\n/src/App/Features/Users/UserCreated.cs\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"request"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#request"}},[this._v("#")]),this._v(" Request")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("The Job's Request holds the input data that will be used by the Handler when the job is processed. It is a class that implements "),s("code",[this._v("IMiruJob")]),this._v(".")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Not")]),t._v(" Found"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" D"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\Projects\\Miru"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("samples"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Skeleton"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Skeleton"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Features"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Orders"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("OrderPlaced"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cs")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"handler"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#handler"}},[this._v("#")]),this._v(" Handler")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("A Job's Handler will be called when the queue scheduler execute the job. It is a class that implements "),s("code",[this._v("IRequestHandler")]),this._v(".")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Not")]),t._v(" Found"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" D"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\Projects\\Miru"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("samples"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Skeleton"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Skeleton"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Features"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Orders"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("OrderPlaced"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cs")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"queueing-jobs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#queueing-jobs"}},[this._v("#")]),this._v(" Queueing Jobs")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Queueing jobs are done through "),s("code",[this._v("Jobs")]),this._v(" class:")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[t._v("_jobs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("PerformLater")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("job"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Handler")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token type-list"}},[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IRequestHandler"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" Order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])])]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("readonly")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Jobs")]),t._v(" _jobs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Handler")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Jobs")]),t._v(" jobs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        _jobs "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" jobs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token return-type class-name"}},[t._v("Task"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("Order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("Handle")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Request")]),t._v(" request"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CancellationToken")]),t._v(" cancellationToken"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token class-name"}},[e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")])]),t._v(" order "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("Order")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),e("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// place order logic")]),t._v("\n        \n        _jobs"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),e("span",{pre:!0,attrs:{class:"token function"}},[t._v("PerformLater")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),e("span",{pre:!0,attrs:{class:"token constructor-invocation class-name"}},[t._v("OrderPlaced"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Request")]),t._v("\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            OrderId "),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Id\n        "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        \n        "),e("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" order"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"processing-queued-jobs"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#processing-queued-jobs"}},[this._v("#")]),this._v(" Processing Queued Jobs")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"server-with-webapp"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server-with-webapp"}},[this._v("#")]),this._v(" Server with WebApp")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("In "),s("code",[this._v("src/App/Startup.cs")]),this._v(" "),s("code",[this._v("ConfigureService")]),this._v(" method, add "),s("code",[this._v("AddHangfireServer")]),this._v(":")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Not")]),t._v(" Found"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" D"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\Projects\\Miru"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("samples"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Mong"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Mong"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Startup"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cs")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h3",{attrs:{id:"server-standalone"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#server-standalone"}},[this._v("#")]),this._v(" Server Standalone")])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"language-shell extra-class"},[s("pre",{pre:!0,attrs:{class:"language-shell"}},[s("code",[this._v("miru queue:run\n")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("div",{staticClass:"warning custom-block"},[s("p",{staticClass:"custom-block-title"},[this._v("WARNING")]),this._v(" "),s("p",[this._v("Pay attention to not run the "),s("code",[this._v("BackgroundJobServer")]),this._v(" in both ways at the same time.")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"dashboard"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#dashboard"}},[this._v("#")]),this._v(" Dashboard")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("Dashboard can be enabled in "),s("code",[this._v("src/App/Startup.cs")]),this._v(" middleware configuration:")])},function(){var t=this,s=t.$createElement,e=t._self._c||s;return e("div",{staticClass:"language-csharp extra-class"},[e("pre",{pre:!0,attrs:{class:"language-csharp"}},[e("code",[e("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Not")]),t._v(" Found"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" D"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\\Projects\\Miru"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("samples"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Mong"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("src"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Mong"),e("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Startup"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cs")])])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("It will use "),s("code",[this._v("Userfy")]),this._v(" authorization to allow only "),s("code",[this._v("Admin")]),this._v(" access the Dashboard. The default url route is "),s("code",[this._v("/_queue")]),this._v(".")])}],!1,null,null,null);s.default=r.exports}}]);